<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Услуги — Piligrim · 2025</title>

  <!-- Шрифты и иконки -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;900&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Alex+Brush&display=swap" rel="stylesheet">

  <!-- Основные стили страницы услуг -->
  <link rel="stylesheet" href="/static/css/services.css">

  <!-- Стили хедера, поиска, корзины, авторизации, AI и т.д. — ТОЧНО как на about_company -->
  <link rel="stylesheet" href="/static/css/search.css">
  <link rel="stylesheet" href="/static/css/auth.css">
  <link rel="stylesheet" href="/static/css/cart.css">
  <link rel="stylesheet" href="/static/css/ai.css">
  <link rel="stylesheet" href="/static/css/contacts.css">

  <!-- ЛОАДЕР + КУРСОР + ОСНОВНЫЕ СТИЛИ (точно как в about_company.css) -->
  

</head>
<body>

  <!-- ЛОАДЕР -->
  <div class="loader" id="pageLoader"></div>



  <!-- КАСТОМНЫЙ КУРСОР (из contacts) -->
  <div class="custom-cursor"></div>

  <!-- ==================== ПОЛНЫЙ ХЕДЕР ИЗ КОНТАКТОВ (с авторизацией, корзиной, обратной связью) ==================== -->
  <header>
    <a href="/" class="logo"><img src="/static/assets/logo.png" alt="Piligrim" class="logo-img"></a>
    <nav>
      <a href="/" class="nav-link">Главная</a>
      <a href="/goods" class="nav-link">Товары</a>
      <a href="/services" class="nav-link active">Услуги</a>
      <a href="/news" class="nav-link">Новости</a>
      <a href="/about_company" class="nav-link">О компании</a>
      <a href="/contacts" class="nav-link">Контакты</a>
    </nav>
    <div class="header-icons">
      <div class="search-wrapper">
        <div class="search-container">
          <div class="search-icon"><i class="fas fa-search"></i></div>
          <input type="text" class="search-input" id="searchInput" placeholder="Поиск...">
          <button id="searchClear" class="search-clear">×</button>
        </div>
        <div id="autocompleteList" class="autocomplete-list"></div>
      </div>
      <button id="authBtn" class="icon-btn"><i class="fas fa-user"></i></button>
      
      <div style="position: relative;">
        <button class="icon-btn" id="cartBtn">
          <i class="fas fa-shopping-bag"></i>
          <span class="cart-count" id="cartCount">0</span>
        </button>
        <div id="miniCartDropdown">
          <div class="mini-cart-header"><div class="mini-cart-title">Корзина</div></div>
          <div class="mini-cart-items" id="miniCartItems"><div class="mini-cart-empty">Корзина пуста</div></div>
          <div class="mini-cart-footer">
            <div class="mini-cart-total" id="miniCartTotal">Итого: 0.00 ₽</div>
            <button class="go-to-cart-btn" id="goToCartBtn">Оформить</button>
          </div>
        </div>
      </div>

      <button class="icon-btn" id="feedbackBtn"><i class="fas fa-envelope"></i></button>
    </div>
  </header>

  <!-- МОДАЛКА ОБРАТНОЙ СВЯЗИ -->
  <div class="custom-alert" id="feedbackModal">
    <div class="alert-content">
      <button class="alert-close" id="closeFeedback">×</button>

      <div class="alert-icon">
        <i class="fas fa-envelope-open-text"></i>
      </div>

      <div class="alert-text">
        <strong>Обратная связь</strong>
        <span>Оставьте заявку — мы свяжемся с вами в ближайшее время</span>
      </div>

      <form class="contact-form" novalidate id="contactForm">
        <input type="text" placeholder="Ваше имя" name="name" required />
        
        <div class="phone-field-wrapper">
          <input type="tel" placeholder="+7 (___) ___-__-__" name="phone" pattern="\+7\s?\(\d{3}\)\s?\d{3}-\d{2}-\d{2}" required />
          <button type="button" class="edit-phone-btn" style="display:none;">Изменить</button>
        </div>
        
        <input type="email" placeholder="Email" name="email" required />
        <textarea placeholder="Ваше сообщение" name="message" required></textarea>

        <button type="submit" id="submitBtn" class="alert-login-btn">
          <span class="btn-text">Отправить сообщение</span>
          <span class="btn-cooldown">Отправка... <span class="timer">30</span>с</span>
        </button>
      </form>
    </div>
  </div>

<!-- МОДАЛКА АВТОРИЗАЦИИ — ПОЛНОСТЬЮ РАБОЧАЯ ВЕРСИЯ -->
<div id="authModal" class="auth-modal">
  <div class="auth-modal-content">
    <button class="close-modal" id="closeAuthModal">×</button>
    <h2 class="auth-title">Вход по номеру телефона</h2>

    <!-- ШАГ 1 — ВВОД НОМЕРА -->
    <div id="stepPhone" class="auth-step">
      <div class="country-selector">
        <div class="selected-country" id="selectedCountry">
          <span class="flag">RU</span>
          <span class="code">+7</span>
          <i class="fas fa-chevron-down"></i>
        </div>
        <div class="country-dropdown" id="countryDropdown">
          <div class="country-item" data-code="+7" data-flag="RU">Россия +7</div>
          <div class="country-item" data-code="+1" data-flag="US">USA +1</div>
          <div class="country-item" data-code="+44" data-flag="GB">UK +44</div>
        </div>
      </div>

      <input type="tel" id="phoneInput" placeholder="(999) 999 99 99" class="auth-input">

      <!-- Обязательное согласие -->
      <label class="checkbox-label required">
        <input type="checkbox" id="privacyCheck">
        <span class="custom-checkbox"></span>
        Согласен с <a href="/policy" target="_blank" class="privacy-link">политикой конфиденциальности</a>
      </label>

      <!-- Автоматическая подписка на рассылку -->
      <label class="checkbox-label">
        <input type="checkbox" id="subscribeCheck" checked>
        <span class="custom-checkbox"></span>
        Получать SMS с акциями и уведомлениями
      </label>

      <button id="sendCodeBtn" class="auth-btn" disabled>Получить код</button>
    </div>

    <!-- ШАГ 2 — ВВОД КОДА -->
    <div id="stepCode" class="auth-step" style="display:none;">
      <p class="auth-info">Код отправлен на <span id="maskedPhone"></span></p>
      <input type="text" id="codeInput" placeholder="____" maxlength="4" class="auth-input">
      <button id="verifyCodeBtn" class="auth-btn">Войти</button>
      <button id="resendCode" class="auth-link">Отправить повторно</button>
    </div>

    <!-- ШАГ 3 — УСПЕШНЫЙ ВХОД -->
    <div id="stepSuccess" class="auth-step" style="display:none;">
      <i class="fas fa-check-circle success-icon"></i>
      <h3>Добро пожаловать!</h3>
      <p>Вы успешно вошли как <span id="welcomePhone"></span></p>
      <button id="closeSuccess" class="auth-btn">Продолжить</button>
    </div>
  </div>
</div>
<!-- КАРТОЧКА ТОВАРА — РАБОЧАЯ, КАК В ZAZA -->
<div class="product-modal" id="productModal">
  <div class="product-content">
    <img id="productImg" class="product-img" src="/static/assets/no-image.png" alt="Товар">
    <div class="product-info">
      <h3 id="productTitle" class="product-title">Загрузка...</h3>
      <div class="product-rating">
        <div class="stars"></div>
        <span id="productReviewsCount" class="reviews-count">—</span>
      </div>
      <div id="productPrice" class="product-price">—</div>
      <div id="productDescription" class="product-description">Загрузка описания...</div>
      <button id="addToCartModal" class="add-to-cart-btn">
        <i class="fas fa-shopping-cart"></i> Купить
      </button>
      <div class="product-reviews">
        <h4 class="reviews-title">Отзывы покупателей</h4>
        <div class="reviews-list">
          <div style="text-align:center;padding:2rem;color:#888;">
            <i class="far fa-star" style="font-size:2.5rem;margin-bottom:0.5rem;display:block;"></i>
            <p>Загрузка отзывов...</p>
          </div>
        </div>
      </div>
    </div>
    <div class="close-modal"><i class="fas fa-times"></i></div>
  </div>
</div>


  
  <div class="white-overlay" id="whiteOverlay"></div>

  <section class="hero" id="hero">
    <div class="slide active"></div>
    <div class="slide"></div>
    <div class="slide"></div>
    <div class="slide"></div>
    <div class="void-cut"></div>
    <div class="scroll-indicator">Скролл вниз для входа</div>
  </section>

  <nav class="side-catalog" id="sideCatalog">
    <div class="catalog-toggle">CATALOGUE</div>
    <ul class="catalog-list"></ul>
  </nav>
  <div class="catalog-arrow-hint" id="catalogArrowHint"></div>

  <section class="light-zone" id="lightZone">
    <div class="sort-panel">
      <button class="sort-btn active" data-sort="default">DEFAULT</button>
      <button class="sort-btn" data-sort="price">PRICE ↑</button>
    </div>
    <div class="grid-controls">
      <button class="grid-btn active" data-cols="3">
        <svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
      </button>
      <button class="grid-btn" data-cols="2">
        <svg viewBox="0 0 24 24"><rect x="3" y="3" width="9" height="18"/><rect x="14" y="3" width="9" height="18"/></svg>
      </button>
    </div>
    <div class="catalog-header"><h1>УСЛУГИ</h1></div>
<div class="search-wrapper" style="max-width:1100px;margin:0 auto 180px;position:relative;">
      <div class="search-container" style="position:relative;max-width:900px;margin:0 auto;">
        
        <input type="text" 
               class="search" 
               id="search" 
               placeholder="Поиск..." 
               style="width:100%;background:transparent;border:none;border-bottom:3px solid #000;font-family:'Inter',sans-serif;font-weight:300;font-size:22px;letter-spacing:4px;color:#000;text-align:center;padding:20px 60px 20px 0;outline:none;box-sizing:border-box;"
               autocomplete="off">

<div class="search-icon" style="position:absolute;right:0;top:50%;transform:translateY(-50%);width:40px;height:40px;opacity:0.35;transition:all .8s cubic-bezier(.16,1,.3,1);pointer-events:none;">
  <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTEiIGN5PSIxMSIgcj0iNyIgc3Ryb2tlPSIjMDAwMDAwIiBzdHJva2Utd2lkdGg9IjIuNCIvPgo8cGF0aCBkPSJNMTYuNSAxNi41TDIwLjUgMjAuNSIgc3Ryb2tlPSIjMDAwMDAwIiBzdHJva2Utd2lkdGg9IjIuNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+Cjwvc3ZnPg==" alt="поиск" style="width:100%;height:100%;display:block;">
</div>
      </div>
    </div>
    <div class="grid" id="grid"></div>
    <div id="adBannerSection" class="noir-island-wrapper">
      <div class="secondary-carousel">
        <div class="carousel-inner" id="services-carousel-inner"></div>
        <div class="indicators"></div>
      </div>
    </div>
  </section>

  <div class="load-more-section">
    <button class="load-more-btn" type="button">LOAD MORE</button>
  </div>

  <!-- МОДАЛКА -->
  <div class="modal" id="modal"><button class="modal-close-btn" aria-label="Закрыть">
  <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round">
    <line x1="18" y1="6" x2="6" y2="18"/>
    <line x1="6" y1="6" x2="18" y2="18"/>
  </svg>
</button><div class="close">×</div>
    <div class="modal-content">
      <div class="modal-gallery">
        <img id="modal-img" src="" alt="">
        <div class="gallery-thumbs" id="modal-thumbs"></div>
      </div>
      <div class="modal-info">
        <div class="info-header">
          <h3 id="modal-title"></h3>
          <div class="price" id="modal-price">₽ —</div>
        </div>
        <p id="modal-desc"></p>
        <div class="rating" id="modal-rating">
          <span class="stars">★★★★★</span>
          <span class="value">0.0</span>
          <span class="count">(0)</span>
        </div>
        <button class="order-btn" id="modal-order">ЗАКАЗАТЬ</button>
        <div class="reviews-section">
          <h4>ОТЗЫВЫ</h4>
          <div class="reviews" id="modal-reviews"></div>
          <p class="no-reviews" id="no-reviews">Отзывов пока нет</p>
        </div>
      </div>
    </div>
  </div>

  <footer id="footer">
    <span>© 2025 Piligrim · NO ADDRESS · NO PHONE</span>
  </footer>

  <!-- УВЕДОМЛЕНИЯ -->
  <div id="toast-container"></div>



<!-- КРАСИВАЯ КНОПКА ВЫХОДА ИЗ БЕЛОЙ ЗОНЫ — ФИНАЛЬНАЯ ВЕРСИЯ 2025 -->
<div id="exitWhiteZoneBtn">
  <span class="exit-text">НАВЕРХ · В NOIR</span>
  <div class="exit-arrow">
    <svg viewBox="0 0 38 38" fill="none" stroke="currentColor" stroke-width="1.7">
      <path d="M19 8v18M11 16l8-8 8 8"/>
    </svg>
  </div>
</div>

<script src="static/js/service.js"></script>
<script src="/static/js/search.js"></script>
<script src="/static/js/auth.js"></script>
<script src="/static/js/cart.js" defer></script>
<script src="/static/js/feedback.js"></script>
<script src="/static/js/ai.js"></script>
<script src="/static/js/contacts.js"></script>

<script>
      document.getElementById('search')?.addEventListener('focus', e => {
        e.target.nextElementSibling.style.opacity = '0.8';
        e.target.nextElementSibling.style.transform = 'translateY(-50%) scale(1.15)';
      });
      document.getElementById('search')?.addEventListener('blur', e => {
        e.target.nextElementSibling.style.opacity = '0.3';
        e.target.nextElementSibling.style.transform = 'translateY(-50%) scale(1)';
      });
</script>
    
<script>
    document.addEventListener('DOMContentLoaded', () => {
      document.body.classList.add('loaded');
      const loader = document.getElementById('pageLoader');
      setTimeout(() => loader.classList.add('hidden'), 900);

      // Кастомный курсор
      const cursor = document.querySelector('.custom-cursor');
      if(cursor){
        document.body.style.cursor = 'none';
        document.addEventListener('mousemove', e => {
          cursor.style.left = e.clientX + 'px';
          cursor.style.top = e.clientY + 'px';
        });
        document.querySelectorAll('a, button, input, textarea, [onclick], .clickable, .nav-link').forEach(el => {
          el.addEventListener('mouseenter', () => cursor.classList.add('hover'));
          el.addEventListener('mouseleave', () => cursor.classList.remove('hover'));
        });
      }

      // Хедер + кнопка наверх
      const header = document.querySelector('header');
      const backToTop = document.querySelector('.back-to-top');
      window.addEventListener('scroll', () => {
        const scrolled = window.pageYOffset;
        header.classList.toggle('scrolled', scrolled > 50);
        backToTop.classList.toggle('visible', scrolled > 500);
      });

      // Плавный скролл по якорям
      document.querySelectorAll('a[href^="#"], .nav-link, .back-to-top').forEach(link => {
        link.addEventListener('click', function(e) {
          const href = this.getAttribute('href');
          if (href === '#' || href.startsWith('#')) {
            e.preventDefault();
            const target = document.querySelector(href === '#' ? 'html' : href);
            if (target) {
              const offset = 80;
              const pos = target.getBoundingClientRect().top + window.pageYOffset - offset;
              window.scrollTo({top: pos, behavior: 'smooth'});
            }
          }
        });
      });
    });
  </script>

<!-- УСЛУГИ → КОРЗИНА + НЕПРОБИВАЕМАЯ ЗАЩИТА ОТ СПАМА (2025 FINAL FIX) -->
<div id="my-toast-container"></div>

<style>
  #my-toast-container{position:fixed;bottom:30px;right:30px;z-index:2147483647;pointer-events:none;font-family:'Inter',sans-serif}
  .mytoast{background:rgba(20,20,20,0.96);color:#fff;padding:18px 28px;margin-top:12px;border-radius:16px;min-width:360px;
    box-shadow:0 20px 60px rgba(0,0,0,0.6);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.12);
    display:flex;align-items:center;gap:16px;transform:translateX(420px);opacity:0;
    transition:all .75s cubic-bezier(.16,1,.3,1);pointer-events:auto;font-weight:500}
  .mytoast.show{transform:translateX(0);opacity:1}
  .mytoast.success{border-left:6px solid #00ff9d}
  .mytoast.error{border-left:6px solid #ff3b30}
  .mytoast i{font-size:1.7em}
</style>

<script>
// Ждём cart.js
document.addEventListener('DOMContentLoaded', () => {
  const check = setInterval(() => {
    if (window.addToCart && window.loadCart) {
      clearInterval(check);
      initServiceCart();
    }
  }, 50);
});

function toast(msg, type = 'success') {
  const c = document.getElementById('my-toast-container');
  const t = document.createElement('div');
  t.className = `mytoast ${type}`;
  t.innerHTML = `<i class="fas fa-${type==='success'?'check-circle':'exclamation-triangle'}"></i><span>${msg}</span>`;
  c.appendChild(t);
  setTimeout(() => t.classList.add('show'), 50);
  setTimeout(() => { t.classList.remove('show'); setTimeout(() => t.remove(), 800); }, 4000);
}

// ГЛОБАЛЬНАЯ ЗАЩИТА ОТ СПАМА — РАБОТАЕТ ВСЕГДА
let spamBlockUntil = 0;
function canClick() {
  const now = Date.now();
  if (now < spamBlockUntil) {
    const sec = Math.ceil((spamBlockUntil - now) / 1000);
    toast(`Слишком быстро! Подождите ${sec} сек.`, 'error');
    return false;
  }
  // 6 кликов за 3 секунды = бан на 30 сек
  if (!window.clickTimes) window.clickTimes = [];
  window.clickTimes = window.clickTimes.filter(t => now - t < 3000);
  window.clickTimes.push(now);
  if (window.clickTimes.length > 6) {
    spamBlockUntil = now + 30000;
    toast('Слишком много кликов! Блокировка 30 сек.', 'error');
    return false;
  }
  return true;
}

// Добавление услуги
async function addService(id) {
  if (!canClick()) return;

  const btn = document.getElementById('modal-order');
  btn.disabled = true;
  btn.textContent = 'Добавляем...';

  try {
    await window.addToCart(id, 'service', 1);
    
    btn.style.transform = 'scale(0.93)';
    setTimeout(() => btn.style.transform = '', 200);

    document.getElementById('modal')?.classList.remove('active');
    document.getElementById('whiteOverlay')?.classList.remove('active');

    toast('Услуга в корзине', 'success');
  } catch (e) {
    toast('Ошибка сети', 'error');
  } finally {
    setTimeout(() => {
      btn.disabled = false;
      btn.textContent = 'ЗАКАЗАТЬ';
    }, 800);
  }
}

// Главная инициализация — БЕЗ cloneNode (это и было причиной багов!)
function initServiceCart() {
  const btn = document.getElementById('modal-order');
  if (!btn) return;

  // УДАЛЯЕМ ВСЕ СТАРЫЕ ОБРАБОТЧИКИ ЧЕРЕЗ ОДИН РАЗОВЫЙ КЛИК
  btn.onclick = null;
  btn.replaceWith(btn.cloneNode(true));
  const newBtn = document.getElementById('modal-order');

  newBtn.addEventListener('click', function (e) {
    e.preventDefault();
    e.stopPropagation();
    const id = this.dataset.serviceId;
    if (id) addService(Number(id));
    else toast('ID услуги не найден', 'error');
  });

  // Обновление корзины при открытии
  document.getElementById('cartBtn')?.addEventListener('click', () => {
    setTimeout(() => window.loadCart?.(), 100);
  });

  console.log('УСЛУГИ → КОРЗИНА: финальная версия 2025 — ЗАЩИТА ОТ СПАМА РАБОТАЕТ');
}
</script>
<script>
// УНИВЕРСАЛЬНЫЙ АНТИСПАМ 2025 — РАБОТАЕТ НА ВСЕХ КНОПКАХ "В КОРЗИНУ" И ИЗМЕНЕНИЯ КОЛИЧЕСТВА
// Защищает от спама: + / – / удалить / любые onclick="addToCart(...)" / кнопки с классами
const GlobalAddToCartProtection = (() => {
  const STORAGE_KEY = 'cart_flood_protection_2025';
  const COOLDOWN_MS = 20000;    // 20 сек блок после спама
  const MAX_CLICKS = 9;         // сколько быстрых кликов разрешено

  let clickCount = 0;
  let resetTimer = null;
  let blockedUntil = 0;

  // Загружаем состояние
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      const data = JSON.parse(saved);
      blockedUntil = data.blockedUntil || 0;
    }
  } catch (e) {}

  const block = () => {
    blockedUntil = Date.now() + COOLDOWN_MS;
    localStorage.setItem(STORAGE_KEY, JSON.stringify({ blockedUntil }));

    // Красивый красный алерт с таймером
    const alert = document.createElement('div');
    alert.id = 'global-cart-flood-alert';
    alert.innerHTML = `
      <i class="fas fa-hand-paper"></i>
      <div>
        <strong>Слишком быстро!</strong><br>
        <small>Подождите <span class="timer">20</span> сек</small>
      </div>
    `;
    Object.assign(alert.style, {
      position: 'fixed', top: '20px', left: '50%', transform: 'translateX(-50%)',
      background: 'linear-gradient(135deg,#ff453a,#ff2d55)', color: 'white',
      padding: '16px 32px', borderRadius: '26px', fontSize: '1.15rem',
      fontWeight: '600', boxShadow: '0 20px 50px rgba(255,45,85,0.5)',
      backdropFilter: 'blur(20px)', display: 'flex', alignItems: 'center', gap: '14px',
      zIndex: '999999', animation: 'slideDown 0.5s ease'
    });
    document.body.appendChild(alert);

    let seconds = 20;
    const timerSpan = alert.querySelector('.timer');
    const interval = setInterval(() => {
      seconds--;
      timerSpan.textContent = seconds;
      if (seconds <= 0) {
        clearInterval(interval);
        alert.remove();
      }
    }, 1000);

    setTimeout(() => alert.remove(), COOLDOWN_MS + 1000);
  };

  return {
    check() {
      const now = Date.now();
      if (blockedUntil > now) return false;

      clickCount++;
      clearTimeout(resetTimer);
      resetTimer = setTimeout(() => { clickCount = 0; }, 10000);

      if (clickCount > MAX_CLICKS) {
        block();
        clickCount = 0;
        return false;
      }
      return true;
    }
  };
})();

// УНИВЕРСАЛЬНЫЙ ПЕРЕХВАТЧИК — ЛОВИТ ВСЁ
document.addEventListener('click', function(e) {
  const target = e.target.closest(
    'button, .add-to-cart-btn, .buy-btn, .apple-qty-btn, .apple-remove-btn, ' +
    '.quantity-btn, .clear-cart-btn, [onclick*="addToCart("]'
  );

  if (!target) return;

  // Проверяем, это действие с корзиной?
  const onclick = target.getAttribute('onclick') || '';
  const isCartAction = 
    onclick.includes('addToCart(') ||
    target.classList.contains('apple-qty-btn') ||
    target.classList.contains('apple-remove-btn') ||
    target.classList.contains('quantity-btn') ||
    target.classList.contains('clear-cart-btn') ||
    target.classList.contains('add-to-cart-btn') ||
    target.classList.contains('buy-btn');

  if (isCartAction && !GlobalAddToCartProtection.check()) {
    e.preventDefault();
    e.stopImmediatePropagation();
    e.stopPropagation();
    return false;
  }
}, true); // true = capture phase → срабатывает раньше всех остальных обработчиков

// Анимация алерта
document.head.insertAdjacentHTML('beforeend', `
<style>
@keyframes slideDown {
  from { transform: translateX(-50%) translateY(-100px); opacity: 0; }
  to   { transform: translateX(-50%) translateY(0); opacity: 1; }
}
#global-cart-flood-alert i { font-size: 1.8rem; }
</style>
`);
</script>
</body>
</html>
